<Window
  x:Class="MermaidPad.Views.MainWindow"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:edit="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
  xmlns:vm="clr-namespace:MermaidPad.ViewModels"
  xmlns:views="clr-namespace:MermaidPad.Views"
  xmlns:panels="clr-namespace:MermaidPad.Views.Panels"
  xmlns:wv="clr-namespace:AvaloniaWebView;assembly=Avalonia.WebView"
  xmlns:converters="clr-namespace:MermaidPad.Converters"
  xmlns:dock="clr-namespace:Dock.Avalonia.Controls;assembly=Dock.Avalonia"
  xmlns:dockModel="clr-namespace:Dock.Model.Mvvm.Controls;assembly=Dock.Model.Mvvm"
  Title="{Binding WindowTitle}"
  Width="1200"
  Height="800"
  x:DataType="vm:MainViewModel"
  Icon="/Assets/AppIcon.ico">

  <Window.Resources>
    <converters:BoolToTooltipConverter x:Key="BoolToTooltipConverter" />
  </Window.Resources>

  <Window.Styles>
    <Style Selector="edit|TextEditor ScrollBar[Orientation=Vertical]">
      <Setter Property="Width" Value="15" />
    </Style>

    <Style Selector="edit|TextEditor ScrollBar[Orientation=Horizontal]">
      <Setter Property="Height" Value="15" />
    </Style>
  </Window.Styles>

  <DockPanel>
    <!-- Menu Bar -->
    <Menu DockPanel.Dock="Top">
      <MenuItem Header="_File">
        <MenuItem
          Command="{Binding OpenFileCommand}"
          CommandParameter="{Binding StorageProvider, RelativeSource={RelativeSource AncestorType=TopLevel}}"
          Header="_Open..."
          InputGesture="Ctrl+O" />
        <MenuItem
          Command="{Binding SaveFileCommand}"
          CommandParameter="{Binding StorageProvider, RelativeSource={RelativeSource AncestorType=TopLevel}}"
          Header="_Save"
          InputGesture="Ctrl+S"
          IsEnabled="{Binding CanSave}" />
        <MenuItem
          Command="{Binding SaveFileAsCommand}"
          CommandParameter="{Binding StorageProvider, RelativeSource={RelativeSource AncestorType=TopLevel}}"
          Header="Save _As..."
          InputGesture="Ctrl+Shift+S"
          IsEnabled="{Binding HasText}" />
        <Separator />
<!--        <MenuItem Header="Recent Files" ItemsSource="{Binding RecentFiles}">
          <MenuItem.ItemTemplate>
            <DataTemplate x:DataType="x:String">
              <MenuItem Header="{Binding}"
                        Command="{ReflectionBinding $parent[TopLevel].DataContext.(vm:MainViewModel.OpenRecentFileCommand), FallbackValue={x:Null}}"
                        CommandParameter="{Binding}" />
            </DataTemplate>
          </MenuItem.ItemTemplate>
        </MenuItem>
        <MenuItem
          Command="{Binding ClearRecentFilesCommand}"
          Header="Clear Recent Files"
          IsEnabled="{Binding HasRecentFiles}" />
        <Separator />-->
        <MenuItem
          Command="{Binding OpenSettingsCommand}"
          Header="Se_ttings..."
          InputGesture="Ctrl+T" />
        <Separator />
        <MenuItem
          Click="OnExitClick"
          Header="E_xit"
          InputGesture="Alt+F4" />
      </MenuItem>
    </Menu>

    <!-- Toolbar -->
    <StackPanel
      Margin="6"
      DockPanel.Dock="Top"
      Orientation="Horizontal"
      Spacing="6">
      <Button
        Width="90"
        Command="{Binding RenderCommand}"
        Content="Render"
        ToolTip.Tip="{Binding !IsWebViewReady, Converter={StaticResource BoolToTooltipConverter}}" />
      <Button
        Command="{Binding ClearCommand}"
        Content="Clear"
        ToolTip.Tip="{Binding !IsWebViewReady, Converter={StaticResource BoolToTooltipConverter}}" />
      <Button
        Command="{Binding ExportCommand}"
        Content="Export"
        ToolTip.Tip="{Binding !IsWebViewReady, Converter={StaticResource BoolToTooltipConverter}}" />
      <Separator Margin="6,0" />
      <CheckBox
        Margin="6,0,0,0"
        Content="Live Preview:"
        FlowDirection="RightToLeft"
        IsChecked="{Binding LivePreviewEnabled}"
        IsEnabled="{Binding IsWebViewReady}"
        ToolTip.Tip="{Binding !IsWebViewReady, Converter={StaticResource BoolToTooltipConverter}}" />
      <!--<TextBlock Margin="20,0,4,0" Text="Bundled:" />
      <TextBlock Text="{Binding BundledMermaidVersion}" />
      <TextBlock Margin="12,0,4,0" Text="Latest:" />
      <TextBlock Text="{Binding LatestMermaidVersion}" />-->
      <TextBlock
        Margin="12,0,0,0"
        HorizontalAlignment="Right"
        VerticalAlignment="Center"
        Text="Version:" />
      <TextBlock
        HorizontalAlignment="Right"
        VerticalAlignment="Center"
        Text="{Binding CurrentMermaidPadVersion}" />
      <TextBlock
        Margin="12,0,0,0"
        VerticalAlignment="Center"
        Foreground="Gray"
        Text="{Binding StatusText}" />
    </StackPanel>

    <!-- Dockable Panel System -->
    <dock:DockControl
      x:Name="MainDock"
      Margin="6,0,6,6"
      Layout="{Binding Layout}">
      <dock:DockControl.DataTemplates>

        <!-- Editor Panel Template -->
        <DataTemplate DataType="dockModel:Tool">
          <Panel>
            <Panel.IsVisible>
              <Binding Path="Id" Converter="{x:Static ObjectConverters.Equal}" ConverterParameter="Editor" />
            </Panel.IsVisible>
            <panels:EditorPanel x:Name="EditorPanel" DataContext="{Binding Context}" />
          </Panel>
        </DataTemplate>

        <!-- Preview Panel Template -->
        <DataTemplate DataType="dockModel:Tool">
          <Panel>
            <Panel.IsVisible>
              <Binding Path="Id" Converter="{x:Static ObjectConverters.Equal}" ConverterParameter="Preview" />
            </Panel.IsVisible>
            <panels:PreviewPanel x:Name="PreviewPanel" DataContext="{Binding Context}" />
          </Panel>
        </DataTemplate>

        <!-- AI Assistant Panel Template -->
        <DataTemplate DataType="dockModel:Tool">
          <Panel>
            <Panel.IsVisible>
              <Binding Path="Id" Converter="{x:Static ObjectConverters.Equal}" ConverterParameter="AIAssistant" />
            </Panel.IsVisible>
            <views:AIPanel DataContext="{Binding Context}" />
          </Panel>
        </DataTemplate>

      </dock:DockControl.DataTemplates>
    </dock:DockControl>
  </DockPanel>
</Window>