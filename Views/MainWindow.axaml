<Window
  x:Class="MermaidPad.Views.MainWindow"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:edit="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
  xmlns:vm="clr-namespace:MermaidPad.ViewModels"
  xmlns:views="clr-namespace:MermaidPad.Views"
  xmlns:wv="clr-namespace:AvaloniaWebView;assembly=Avalonia.WebView"
  xmlns:converters="clr-namespace:MermaidPad.Converters"
  Title="MermaidPad - The Cross-Platform Mermaid Chart Editor"
  Width="1400"
  Height="800"
  x:DataType="vm:MainViewModel"
  Icon="/Assets/AppIcon.ico">

  <Window.Resources>
    <converters:BoolToTooltipConverter x:Key="BoolToTooltipConverter" />
  </Window.Resources>

  <Window.Styles>
    <Style Selector="edit|TextEditor ScrollBar[Orientation=Vertical]">
      <Setter Property="Width" Value="15" />
    </Style>

    <Style Selector="edit|TextEditor ScrollBar[Orientation=Horizontal]">
      <Setter Property="Height" Value="15" />
    </Style>
  </Window.Styles>

  <DockPanel>
    <!--  Toolbar  -->
    <StackPanel
      Margin="6"
      DockPanel.Dock="Top"
      Orientation="Horizontal"
      Spacing="6">
      <Button
        Width="90"
        Command="{Binding RenderCommand}"
        Content="Render"
        ToolTip.Tip="{Binding !IsWebViewReady, Converter={StaticResource BoolToTooltipConverter}}" />
      <Button
        Command="{Binding ClearCommand}"
        Content="Clear"
        ToolTip.Tip="{Binding !IsWebViewReady, Converter={StaticResource BoolToTooltipConverter}}" />
      <Button
        Command="{Binding ExportCommand}"
        Content="Export"
        ToolTip.Tip="{Binding !IsWebViewReady, Converter={StaticResource BoolToTooltipConverter}}" />
      <Separator Margin="6,0" />
      <Button
        Command="{Binding ToggleAIPanelCommand}"
        Content="{Binding IsAIPanelVisible, Converter={x:Static ObjectConverters.TrueToObject}, ConverterParameter='Hide AI', FalseValue='Show AI'}"
        ToolTip.Tip="Show or hide the AI Assistant panel" />
      <Button
        Command="{Binding SwapEditorPreviewCommand}"
        Content="Swap Panels"
        ToolTip.Tip="Swap the positions of editor and preview" />
      <Separator Margin="6,0" />
      <Button
        Command="{Binding OpenSettingsCommand}"
        Content="Settings"
        ToolTip.Tip="Configure AI and other settings" />
      <Button
        Click="OnCloseClick"
        Content="Close" />
      <CheckBox
        Margin="12,0,0,0"
        Content="Live Preview:"
        FlowDirection="RightToLeft"
        IsChecked="{Binding LivePreviewEnabled}"
        IsEnabled="{Binding IsWebViewReady}"
        ToolTip.Tip="{Binding !IsWebViewReady, Converter={StaticResource BoolToTooltipConverter}}" />
      <TextBlock
        Margin="12,0,0,0"
        HorizontalAlignment="Right"
        VerticalAlignment="Center"
        Text="Version:" />
      <TextBlock
        HorizontalAlignment="Right"
        VerticalAlignment="Center"
        Text="{Binding CurrentMermaidPadVersion}" />
    </StackPanel>

    <!--  Main Content Area with Dynamic Layout  -->
    <Grid x:Name="MainContentGrid" ColumnDefinitions="300,4,*">
      <!--  Left Panel (AI Panel when visible)  -->
      <Grid
        x:Name="LeftPanelGrid"
        Grid.Column="0"
        IsVisible="{Binding IsAIPanelVisible}">
        <views:AIPanel DataContext="{Binding AIPanelViewModel}" />
      </Grid>

      <!--  Left Splitter  -->
      <GridSplitter
        x:Name="LeftSplitter"
        Grid.Column="1"
        Width="4"
        Background="Gray"
        IsVisible="{Binding IsAIPanelVisible}" />

      <!--  Center Content (Editor and Preview)  -->
      <Grid
        x:Name="CenterGrid"
        Grid.Column="2"
        ColumnDefinitions="*,4,*">
        <!--  Editor Panel  -->
        <Border
          x:Name="EditorPanel"
          Grid.Column="0"
          BorderBrush="#E0E0E0"
          BorderThickness="0">
          <DockPanel>
            <Border
              DockPanel.Dock="Top"
              Background="#F5F5F5"
              BorderBrush="#E0E0E0"
              BorderThickness="0,0,0,1"
              Padding="8,4">
              <TextBlock
                FontSize="12"
                FontWeight="SemiBold"
                Text="Editor" />
            </Border>
            <edit:TextEditor
              x:Name="Editor"
              FontFamily="Consolas"
              HorizontalScrollBarVisibility="Auto"
              LineNumbersForeground="Lime"
              ShowLineNumbers="True"
              SyntaxHighlighting="Mermaid"
              VerticalScrollBarVisibility="Auto" />
          </DockPanel>
        </Border>

        <!--  Center Splitter  -->
        <GridSplitter
          Grid.Column="1"
          Width="4"
          Background="Gray" />

        <!--  Preview Panel  -->
        <Border
          x:Name="PreviewPanel"
          Grid.Column="2"
          BorderBrush="#E0E0E0"
          BorderThickness="0">
          <DockPanel>
            <Border
              DockPanel.Dock="Top"
              Background="#F5F5F5"
              BorderBrush="#E0E0E0"
              BorderThickness="0,0,0,1"
              Padding="8,4">
              <TextBlock
                FontSize="12"
                FontWeight="SemiBold"
                Text="Preview" />
            </Border>
            <wv:WebView x:Name="Preview" />
          </DockPanel>
        </Border>
      </Grid>
    </Grid>
  </DockPanel>
</Window>
