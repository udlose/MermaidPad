<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>MermaidPad Preview</title>
    <style>
        body { margin:0; font-family: system-ui, sans-serif; background:#1e1e1e; color:#ddd; }
        #output { padding:8px; overflow:auto; height:100vh; box-sizing:border-box; }
        .error { color:#ff6f6f; white-space:pre; font-family:Consolas,monospace; }
    </style>
    <script src="mermaid.min.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const output = document.getElementById('output');
            if (window.mermaid) {
                mermaid.initialize({ startOnLoad: false, theme: 'dark' });
            } else {
                output.innerHTML = '<div class="error">Mermaid library failed to load.</div>';
            }
        });

        window.renderMermaid = (source) => {
            const output = document.getElementById('output');
            if (!window.mermaid) {
                output.innerHTML = '<div class="error">Mermaid library is not loaded.</div>';
                return;
            }
            const id = `mermaid-svg-${Date.now()}`;
            mermaid.render(id, source)
                .then(result => {
                    output.innerHTML = result.svg;
                    if (typeof result.bindFunctions === 'function') {
                        result.bindFunctions(output);
                    }
                })
                .catch(e => {
                    output.innerHTML = `<div class="error">${e.message}</div>`;
                });
        };

        window.clearOutput = () => {
            document.getElementById('output').innerHTML = '';
        };
    </script>
</head>
<body>
    <div id="output">Click 'Render' or 'Enable Live Preview'</div>
</body>
</html>